# Migration `20200321151623-update-models`

This migration has been generated by Frederick Morin at 3/21/2020, 3:16:23 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
DROP INDEX "quaint"."SkillDomain.domain"

DROP INDEX "quaint"."Skill.skill"

DROP INDEX "quaint"."Availability.availability"

CREATE TABLE "quaint"."Language" (
    "id" INTEGER NOT NULL  PRIMARY KEY AUTOINCREMENT,
    "name" TEXT NOT NULL DEFAULT '' 
) 

PRAGMA foreign_keys=OFF;

CREATE TABLE "quaint"."new_User" (
    "committeeRecruitmentConsent" BOOLEAN NOT NULL DEFAULT false ,
    "contactPreference" TEXT NOT NULL DEFAULT 'email' ,
    "createdAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00' ,
    "dateOfBirth" DATE NOT NULL DEFAULT '1970-01-01 00:00:00' ,
    "email" TEXT NOT NULL DEFAULT '' ,
    "firstName" TEXT NOT NULL DEFAULT '' ,
    "gender" TEXT NOT NULL DEFAULT 'male' ,
    "id" INTEGER NOT NULL  PRIMARY KEY AUTOINCREMENT,
    "lang" INTEGER NOT NULL  ,
    "lastName" TEXT NOT NULL DEFAULT '' ,
    "location" TEXT NOT NULL DEFAULT '' ,
    "otherSkills" TEXT   ,
    "phone" TEXT   ,
    "updatedAt" DATE NOT NULL DEFAULT '1970-01-01 00:00:00' ,FOREIGN KEY ("lang") REFERENCES "Language"("id") ON DELETE RESTRICT ON UPDATE CASCADE
) 

INSERT INTO "quaint"."new_User" ("committeeRecruitmentConsent", "contactPreference", "createdAt", "dateOfBirth", "email", "firstName", "gender", "id", "lang", "lastName", "location", "otherSkills", "phone", "updatedAt") SELECT "committeeRecruitmentConsent", "contactPreference", "createdAt", "dateOfBirth", "email", "firstName", "gender", "id", "lang", "lastName", "location", "otherSkills", "phone", "updatedAt" FROM "quaint"."User"

DROP TABLE "quaint"."User";

ALTER TABLE "quaint"."new_User" RENAME TO "User";

CREATE UNIQUE INDEX "quaint"."User.email" ON "User"("email")

PRAGMA "quaint".foreign_key_check;

PRAGMA foreign_keys=ON;

PRAGMA foreign_keys=OFF;

CREATE TABLE "quaint"."new_SkillDomain" (
    "id" INTEGER NOT NULL  PRIMARY KEY AUTOINCREMENT,
    "name" TEXT NOT NULL DEFAULT '' 
) 

INSERT INTO "quaint"."new_SkillDomain" ("id") SELECT "id" FROM "quaint"."SkillDomain"

DROP TABLE "quaint"."SkillDomain";

ALTER TABLE "quaint"."new_SkillDomain" RENAME TO "SkillDomain";

CREATE UNIQUE INDEX "quaint"."SkillDomain.name" ON "SkillDomain"("name")

PRAGMA "quaint".foreign_key_check;

PRAGMA foreign_keys=ON;

PRAGMA foreign_keys=OFF;

CREATE TABLE "quaint"."new_Skill" (
    "domain" INTEGER NOT NULL  ,
    "id" INTEGER NOT NULL  PRIMARY KEY AUTOINCREMENT,
    "name" TEXT NOT NULL DEFAULT '' ,FOREIGN KEY ("domain") REFERENCES "SkillDomain"("id") ON DELETE RESTRICT ON UPDATE CASCADE
) 

INSERT INTO "quaint"."new_Skill" ("domain", "id") SELECT "domain", "id" FROM "quaint"."Skill"

DROP TABLE "quaint"."Skill";

ALTER TABLE "quaint"."new_Skill" RENAME TO "Skill";

CREATE UNIQUE INDEX "quaint"."Skill.name" ON "Skill"("name")

PRAGMA "quaint".foreign_key_check;

PRAGMA foreign_keys=ON;

PRAGMA foreign_keys=OFF;

CREATE TABLE "quaint"."new_Availability" (
    "id" INTEGER NOT NULL  PRIMARY KEY AUTOINCREMENT,
    "name" TEXT NOT NULL DEFAULT '' 
) 

INSERT INTO "quaint"."new_Availability" ("id") SELECT "id" FROM "quaint"."Availability"

DROP TABLE "quaint"."Availability";

ALTER TABLE "quaint"."new_Availability" RENAME TO "Availability";

CREATE UNIQUE INDEX "quaint"."Availability.name" ON "Availability"("name")

PRAGMA "quaint".foreign_key_check;

PRAGMA foreign_keys=ON;

CREATE UNIQUE INDEX "quaint"."Language.name" ON "Language"("name")
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200318163901-initial..20200321151623-update-models
--- datamodel.dml
+++ datamodel.dml
@@ -1,11 +1,11 @@
 datasource DS {
   provider = "sqlite"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 generator photonjs {
-  provider = "prisma-client-js"
+  provider      = "prisma-client-js"
   binaryTargets = env("BINARY_TARGET")
 }
 // Define your own datamodels here and run `yarn redwood db save` to create
@@ -32,33 +32,35 @@
 }
 model SkillDomain {
   id     Int     @id @default(autoincrement())
-  domain String  @unique
+  name   String  @unique
   skills Skill[]
   users  User[]
 }
 model Skill {
   id     Int         @id @default(autoincrement())
-  skill  String      @unique
+  name   String      @unique
   domain SkillDomain
   users  User[]
 }
 model Availability {
-  id           Int    @id @default(autoincrement())
-  availability String @unique
-  users        User[]
+  id    Int    @id @default(autoincrement())
+  name  String @unique
+  users User[]
 }
+model Language {
+  id    Int    @id @default(autoincrement())
+  name  String @unique
+  users User[]
+}
+
 enum Gender {
   male female
 }
 enum ContactBy {
   email phone text
-}
-
-enum Language {
-  fr en
-}
+}
```


