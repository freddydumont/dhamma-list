# Migration `20200421172756-split-user-profile`

This migration has been generated by Frederick Morin at 4/21/2020, 5:27:56 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."Profile" (
    "committeeRecruitmentConsent" boolean  NOT NULL DEFAULT false,
    "contactPreference" "ContactBy" NOT NULL ,
    "dateOfBirth" timestamp(3)  NOT NULL ,
    "gender" "Gender" NOT NULL ,
    "id" SERIAL,
    "lang" integer  NOT NULL ,
    "location" text  NOT NULL ,
    "phone" text   ,
    "userComment" text   ,
    "userId" integer  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "public"."_ProfileToSkillDomain" (
    "A" integer  NOT NULL ,
    "B" integer  NOT NULL 
) 

CREATE TABLE "public"."_ProfileToSkill" (
    "A" integer  NOT NULL ,
    "B" integer  NOT NULL 
) 

CREATE TABLE "public"."_AvailabilityToProfile" (
    "A" integer  NOT NULL ,
    "B" integer  NOT NULL 
) 

ALTER TABLE "public"."User" DROP CONSTRAINT IF EXiSTS "User_lang_fkey",
DROP COLUMN "committeeRecruitmentConsent",
DROP COLUMN "contactPreference",
DROP COLUMN "dateOfBirth",
DROP COLUMN "gender",
DROP COLUMN "lang",
DROP COLUMN "location",
DROP COLUMN "otherSkills",
DROP COLUMN "phone";

CREATE UNIQUE INDEX "Profile_userId" ON "public"."Profile"("userId")

CREATE UNIQUE INDEX "_ProfileToSkillDomain_AB_unique" ON "public"."_ProfileToSkillDomain"("A","B")

CREATE  INDEX "_ProfileToSkillDomain_B_index" ON "public"."_ProfileToSkillDomain"("B")

CREATE UNIQUE INDEX "_ProfileToSkill_AB_unique" ON "public"."_ProfileToSkill"("A","B")

CREATE  INDEX "_ProfileToSkill_B_index" ON "public"."_ProfileToSkill"("B")

CREATE UNIQUE INDEX "_AvailabilityToProfile_AB_unique" ON "public"."_AvailabilityToProfile"("A","B")

CREATE  INDEX "_AvailabilityToProfile_B_index" ON "public"."_AvailabilityToProfile"("B")

ALTER TABLE "public"."Profile" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."Profile" ADD FOREIGN KEY ("lang")REFERENCES "public"."Language"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_ProfileToSkillDomain" ADD FOREIGN KEY ("A")REFERENCES "public"."Profile"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_ProfileToSkillDomain" ADD FOREIGN KEY ("B")REFERENCES "public"."SkillDomain"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_ProfileToSkill" ADD FOREIGN KEY ("A")REFERENCES "public"."Profile"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_ProfileToSkill" ADD FOREIGN KEY ("B")REFERENCES "public"."Skill"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_AvailabilityToProfile" ADD FOREIGN KEY ("A")REFERENCES "public"."Availability"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "public"."_AvailabilityToProfile" ADD FOREIGN KEY ("B")REFERENCES "public"."Profile"("id") ON DELETE CASCADE  ON UPDATE CASCADE

DROP TABLE "public"."_AvailabilityToUser";

DROP TABLE "public"."_SkillDomainToUser";

DROP TABLE "public"."_SkillToUser";
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200415110824-initial-beta-2..20200421172756-split-user-profile
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource DS {
   provider = "postgresql"
-  url = "***"
+  url      = env("DATABASE_URL")
 }
 generator photonjs {
   provider      = "prisma-client-js"
@@ -9,60 +9,70 @@
 }
 // Define your own datamodels here and run `yarn redwood db save` to create
 // migrations for them.
+model User {
+  id        Int      @default(autoincrement()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  firstName String
+  lastName  String
+  email     String   @unique
+  profile   Profile?
+}
-model User {
-  id                          Int            @id @default(autoincrement())
-  createdAt                   DateTime       @default(now())
-  updatedAt                   DateTime       @updatedAt
-  firstName                   String
-  lastName                    String
+model Profile {
+  id                          Int            @default(autoincrement()) @id
+  user                        User           @relation(fields: [userId], references: [id])
+  userId                      Int
   dateOfBirth                 DateTime
   gender                      Gender
   lang                        Language       @relation(fields: [langId], references: [id])
   langId                      Int            @map("lang")
   location                    String
   phone                       String?
-  email                       String         @unique
   contactPreference           ContactBy
   skillDomains                SkillDomain[]  @relation(references: [id])
   skills                      Skill[]        @relation(references: [id])
-  otherSkills                 String?
+  // text area in the form where user can add comments or extra skills
+  userComment                 String?
   availabilities              Availability[] @relation(references: [id])
   committeeRecruitmentConsent Boolean        @default(false)
 }
 model SkillDomain {
-  id     Int     @id @default(autoincrement())
-  name   String  @unique
-  skills Skill[]
-  users  User[]  @relation(references: [id])
+  id       Int       @default(autoincrement()) @id
+  name     String    @unique
+  skills   Skill[]
+  profiles Profile[] @relation(references: [id])
 }
 model Skill {
-  id       Int         @id @default(autoincrement())
+  id       Int         @default(autoincrement()) @id
   name     String      @unique
   domain   SkillDomain @relation(fields: [domainId], references: [id])
   domainId Int         @map("domain")
-  users    User[]      @relation(references: [id])
+  profiles Profile[]   @relation(references: [id])
 }
 model Availability {
-  id    Int    @id @default(autoincrement())
-  name  String @unique
-  users User[] @relation(references: [id])
+  id       Int       @default(autoincrement()) @id
+  name     String    @unique
+  profiles Profile[] @relation(references: [id])
 }
 model Language {
-  id    Int    @id @default(autoincrement())
-  name  String @unique
-  users User[] @relation(references: [id])
+  id       Int       @default(autoincrement()) @id
+  name     String    @unique
+  profiles Profile[] @relation(references: [id])
 }
 enum Gender {
-  male female
+  male
+  female
 }
 enum ContactBy {
-  email phone text
+  email
+  phone
+  text
 }
```


